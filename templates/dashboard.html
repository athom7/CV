{% extends "base.html" %}

{% block title %}Dashboard - Job Tracker{% endblock %}

{% block content %}
<div class="stats-grid">
    <div class="stat-card stat-total">
        <div class="stat-number">{{ stats.total }}</div>
        <div class="stat-label">Total Applied</div>
    </div>
    <div class="stat-card stat-rate">
        <div class="stat-number">{{ stats.response_rate }}%</div>
        <div class="stat-label">Response Rate</div>
    </div>
    <div class="stat-card stat-week">
        <div class="stat-number">{{ stats.past_week }}</div>
        <div class="stat-label">This Week</div>
    </div>
    <div class="stat-card stat-interview">
        <div class="stat-number">{{ stats.status_counts.get('Interview', 0) }}</div>
        <div class="stat-label">Interviews</div>
    </div>
</div>

<div class="filter-bar">
    <span class="filter-label">Filter:</span>
    <a href="{{ url_for('dashboard') }}" class="filter-chip {% if not current_filter %}active{% endif %}">All</a>
    {% for status in statuses %}
    <a href="{{ url_for('dashboard', status=status) }}"
       class="filter-chip status-{{ status|lower }} {% if current_filter == status %}active{% endif %}">
        {{ status }} ({{ stats.status_counts.get(status, 0) }})
    </a>
    {% endfor %}
</div>

{% if applications %}
<div class="applications-table">
    <table>
        <thead>
            <tr>
                <th>Company</th>
                <th>Role</th>
                <th>Applied</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for app in applications %}
            <tr class="status-row-{{ app.status|lower }}">
                <td class="company-cell">
                    <strong>{{ app.company }}</strong>
                    {% if app.job_url %}
                    <a href="{{ app.job_url }}" target="_blank" class="link-icon" title="View job posting">ğŸ”—</a>
                    {% endif %}
                </td>
                <td>{{ app.role }}</td>
                <td class="date-cell">{{ app.application_date }}</td>
                <td>
                    <select class="status-select status-{{ app.status|lower }}"
                            onchange="updateStatus({{ app.id }}, this.value)">
                        {% for status in statuses %}
                        <option value="{{ status }}" {% if app.status == status %}selected{% endif %}>
                            {{ status }}
                        </option>
                        {% endfor %}
                    </select>
                </td>
                <td class="actions-cell">
                    <a href="{{ url_for('edit_application', id=app.id) }}" class="btn btn-small">Edit</a>
                    <form action="{{ url_for('delete_application', id=app.id) }}" method="POST" style="display:inline;">
                        <button type="submit" class="btn btn-small btn-danger"
                                onclick="confirmDelete(event, '{{ app.company }}')">Delete</button>
                    </form>
                </td>
            </tr>
            {% if app.notes %}
            <tr class="notes-row">
                <td colspan="5" class="notes-cell">ğŸ“ {{ app.notes }}</td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="empty-state">
    <div class="empty-icon">ğŸ“­</div>
    <h2>No applications yet</h2>
    <p>Start tracking your job search by adding your first application!</p>
    <a href="{{ url_for('add_application') }}" class="btn btn-primary btn-large">Add Your First Application</a>
</div>
{% endif %}
{% endblock %}
